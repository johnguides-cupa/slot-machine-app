(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();class E{constructor(){this.initializeDefaults()}initializeDefaults(){if(!this.getPrizes().length){const e=[{id:1,name:"Chocolate Bar",image:"https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png",quantity:50,chance:60},{id:2,name:"Gift Card",image:"https://static.vecteezy.com/system/resources/previews/027/879/811/non_2x/gift-card-in-pixel-art-style-vector.jpg",quantity:10,chance:25},{id:3,name:"Premium Prize",image:"https://static.vecteezy.com/system/resources/previews/052/100/288/non_2x/pixel-art-gift-game-asset-design-free-vector.jpg",quantity:5,chance:15}];this.setPrizes(e)}localStorage.getItem("gameMode")||localStorage.setItem("gameMode","probability")}getPrizes(){const e=localStorage.getItem("prizes");return e?JSON.parse(e):[]}setPrizes(e){localStorage.setItem("prizes",JSON.stringify(e))}addPrize(e){const t=this.getPrizes();return e.id=Date.now(),t.push(e),this.setPrizes(t),e}updatePrize(e){const t=this.getPrizes(),i=t.findIndex(n=>n.id===e.id);return i!==-1?(t[i]=e,this.setPrizes(t),!0):!1}deletePrize(e){const t=this.getPrizes(),i=t.filter(n=>n.id!==e);return this.setPrizes(i),i.length!==t.length}getGameMode(){return localStorage.getItem("gameMode")||"probability"}setGameMode(e){localStorage.setItem("gameMode",e)}getDeck(){const e=localStorage.getItem("deck");return e?JSON.parse(e):[]}setDeck(e){localStorage.setItem("deck",JSON.stringify(e))}generateDeck(){const e=this.getPrizes(),t=[];e.forEach(i=>{for(let n=0;n<i.quantity;n++)t.push(i.id)});for(let i=t.length-1;i>0;i--){const n=Math.floor(Math.random()*(i+1));[t[i],t[n]]=[t[n],t[i]]}return this.setDeck(t),t}drawFromDeck(){const e=this.getDeck();if(e.length===0)return this.generateDeck(),this.drawFromDeck();const t=e.pop();return this.setDeck(e),t}getLogs(){const e=localStorage.getItem("spinLogs");return e?JSON.parse(e):[]}addLog(e){const t=this.getLogs();e.timestamp=new Date().toISOString(),t.unshift(e),t.length>100&&t.splice(100),localStorage.setItem("spinLogs",JSON.stringify(t))}clearLogs(){localStorage.removeItem("spinLogs")}resetAll(){localStorage.removeItem("prizes"),localStorage.removeItem("deck"),localStorage.removeItem("spinLogs"),localStorage.removeItem("gameMode"),this.initializeDefaults()}getRemainingPrizesCount(){const e=this.getDeck(),t=this.getPrizes(),i={};return t.forEach(n=>{i[n.id]=0}),e.forEach(n=>{i[n]!==void 0&&i[n]++}),i}}window.storageManager=new E;class M{constructor(){this.isSpinning=!1,this.reelHeight=null,this.idleTimelines=[]}createReelItems(e,t=null){const i=[];for(let n=0;n<15;n++)e.forEach(s=>{i.push(this.createReelItem(s))});return i}createReelItem(e){const t=document.createElement("div");return t.className="reel-item",t.innerHTML=`
            <img src="${e.image}" alt="${e.name}" onerror="this.src='https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png'">
            <span>${e.name}</span>
        `,this.reelHeight||(document.body.appendChild(t),this.reelHeight=t.offsetHeight,document.body.removeChild(t)),t}populateReels(e){document.querySelectorAll(".reel").forEach((i,n)=>{const s=i.querySelector(".reel-strip");s.innerHTML="",this.createReelItems(e).forEach(a=>s.appendChild(a)),gsap.set(s,{y:-this.reelHeight})}),this.startIdleAnimation()}startIdleAnimation(){this.stopIdleAnimation();const e=Array.from(document.querySelectorAll(".reel .reel-strip"));this.idleTimelines=[];const t=[6,7.5,9];e.forEach((i,n)=>{const s=gsap.timeline({repeat:-1}),a=gsap.getProperty(i,"y")-this.reelHeight*10;s.to(i,{y:a,duration:t[n%t.length],ease:"linear"}),this.idleTimelines.push(s)})}stopIdleAnimation(){this.idleTimelines&&this.idleTimelines.length&&this.idleTimelines.forEach(e=>e.kill()),this.idleTimelines=[]}async spinReels(e,t,i){if(this.isSpinning)return;this.isSpinning=!0,this.stopIdleAnimation();const n=Array.from(document.querySelectorAll(".reel .reel-strip")),s=document.getElementById("spinButton");if(s.disabled=!0,s.querySelector(".button-text").textContent="SPINNING...",!this.reelHeight){const c=this.createReelItem(t[0]);document.body.appendChild(c),this.reelHeight=c.offsetHeight,document.body.removeChild(c)}const o=30,a=10;n.forEach((c,f)=>{c.innerHTML="";for(let u=0;u<o;u++){const z=t[Math.floor(Math.random()*t.length)];c.appendChild(this.createReelItem(z))}c.appendChild(this.createReelItem(i[f]));for(let u=0;u<a;u++){const z=t[Math.floor(Math.random()*t.length)];c.appendChild(this.createReelItem(z))}const y=Math.floor(c.parentNode.offsetHeight/this.reelHeight),p=this.reelHeight*Math.floor(y/2);gsap.set(c,{y:-(o*this.reelHeight-p)})});const r=n.map((c,f)=>{const y=o,p=Math.floor(c.parentNode.offsetHeight/this.reelHeight),u=this.reelHeight*Math.floor(p/2);return-(y*this.reelHeight-u)}),l=.15,d=15,h=1.5,g=this.reelHeight*10,P=n.map((c,f)=>new Promise(y=>{const p=gsap.timeline({repeat:-1});p.to(c,{y:`-=${g}`,duration:l,ease:"none"}),setTimeout(()=>{p.kill(),gsap.to(c,{y:r[f],duration:1.2,ease:"power3.out",onComplete:y})},f*h*1e3+d*l*1e3)}));for(let c=0;c<P.length;c++)await P[c];setTimeout(()=>{this.showPrizePopup(e)},500),s.disabled=!1,s.querySelector(".button-text").textContent="SPIN!",this.isSpinning=!1,document.getElementById("closePopup").addEventListener("click",()=>{setTimeout(()=>{this.populateReels(t)},400)},{once:!0})}calculateTargetPositions(e,t){const i=[],n=t.length;for(let s=0;s<3;s++){let o=t.findIndex(h=>h.id===e.id);o===-1&&(o=0);const r=(7+Math.floor(Math.random()*2))*n+o,l=this.reelHeight,d=-(r*this.reelHeight-l);i.push(d)}return i}animateReel(e,t,i){return new Promise(n=>{const s=gsap.timeline();s.to(e,{y:t-this.reelHeight*10,duration:i*.7,ease:"power2.in"}),s.to(e,{y:t,duration:i*.3,ease:"power3.out",onComplete:()=>{n()}})})}showPrizePopup(e){const t=document.getElementById("prizePopup"),i=document.getElementById("wonPrizeImage"),n=document.getElementById("wonPrizeName"),s=document.getElementById("prizePopupTitle"),o=t.querySelector(".prize-shield");i.src=e.image,n.textContent=e.name,e.isDefault?(s&&(s.textContent="Better luck next time!"),o&&(o.textContent="üò¢")):(s&&(s.textContent="Congratulations!"),o&&(o.textContent="üèÜ")),t.classList.remove("hidden"),gsap.fromTo(t.querySelector(".popup-content"),{scale:0,rotation:-10},{scale:1,rotation:0,duration:.5,ease:"back.out(1.7)"}),e.isDefault||this.triggerConfetti()}triggerConfetti(){const t=Date.now()+3e3,i={startVelocity:30,spread:360,ticks:60,zIndex:999};function n(o,a){return Math.random()*(a-o)+o}const s=setInterval(function(){const o=t-Date.now();if(o<=0)return clearInterval(s);const a=50*(o/3e3);confetti(Object.assign({},i,{particleCount:a,origin:{x:n(.1,.3),y:Math.random()-.2}})),confetti(Object.assign({},i,{particleCount:a,origin:{x:n(.7,.9),y:Math.random()-.2}}))},250)}closePrizePopup(){const e=document.getElementById("prizePopup");gsap.to(e.querySelector(".popup-content"),{scale:0,rotation:10,duration:.3,ease:"back.in(1.7)",onComplete:()=>{e.classList.add("hidden")}})}animatePrizeShowcase(){const e=document.querySelectorAll(".prize-item");gsap.fromTo(e,{y:-50,opacity:0},{y:0,opacity:1,duration:.6,stagger:.1,ease:"back.out(1.7)"})}initializeButtonEffects(){const e=document.getElementById("spinButton");e.addEventListener("mouseenter",()=>{e.disabled||gsap.to(e,{scale:1.05,duration:.2})}),e.addEventListener("mouseleave",()=>{e.disabled||gsap.to(e,{scale:1,duration:.2})})}}window.animationManager=new M;class I{constructor(){this.currentEditingPrize=null,this.initializeEventListeners()}initializeEventListeners(){document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>this.switchTab(e.dataset.tab))}),document.getElementById("closeAdmin").addEventListener("click",()=>{if(storageManager.getPrizes().reduce((i,n)=>i+n.chance,0)!==100){alert("Total win chance must be exactly 100% before closing the admin panel.");return}this.hide()}),document.getElementById("addPrize").addEventListener("click",()=>{this.showPrizeEditor()}),document.getElementById("savePrize").addEventListener("click",()=>{this.savePrize()}),document.getElementById("cancelEdit").addEventListener("click",()=>{this.hidePrizeEditor()}),document.querySelectorAll('input[name="gameMode"]').forEach(e=>{e.addEventListener("change",()=>{storageManager.setGameMode(e.value),this.updateGameModeDisplay()})}),document.getElementById("resetGame").addEventListener("click",()=>{confirm("Are you sure you want to reset the game and clear all logs?")&&this.resetGame()})}show(){document.getElementById("adminPanel").classList.remove("hidden"),this.refreshContent()}hide(){document.getElementById("adminPanel").classList.add("hidden"),this.hidePrizeEditor()}switchTab(e){switch(document.querySelectorAll(".tab-button").forEach(t=>{t.classList.remove("active")}),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.remove("active")}),document.getElementById(`${e}Tab`).classList.add("active"),e){case"prizes":this.refreshPrizesList();break;case"settings":this.refreshSettings();break;case"logs":this.refreshLogs();break}}refreshContent(){this.refreshPrizesList(),this.refreshSettings(),this.refreshLogs()}refreshPrizesList(){const e=document.getElementById("prizesList"),t=storageManager.getPrizes();e.innerHTML="",t.forEach(i=>{const n=document.createElement("div");n.className="prize-card",n.innerHTML=`
                <img src="${i.image}" alt="${i.name}" onerror="this.src='https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png'">
                <div class="prize-info">
                    <h4>${i.name}</h4>
                    <p>Quantity: ${i.quantity}</p>
                    <p>Win Chance: ${i.chance}%</p>
                </div>
                <div class="prize-actions">
                    <button onclick="adminPanel.editPrize(${i.id})">Edit</button>
                    <button class="delete" onclick="adminPanel.deletePrize(${i.id})">Delete</button>
                </div>
            `,e.appendChild(n)})}showPrizeEditor(e=null){const t=document.getElementById("prizeEditor"),i=document.getElementById("editorTitle");function n(l,d){const h=document.getElementById(l);if(h){let g=document.getElementById(l+"-label");g||(g=document.createElement("label"),g.id=l+"-label",g.htmlFor=l,g.textContent=d,g.style.display="block",g.style.fontWeight="bold",g.style.margin="8px 0 2px 0",h.parentNode.insertBefore(g,h))}}n("prizeName","Prize Name"),n("prizeImage","Prize Image URL"),n("prizeQuantity","Quantity"),n("prizeChance","Win Chance (%)"),e?(this.currentEditingPrize=e,i.textContent="Edit Prize",document.getElementById("prizeName").value=e.name,document.getElementById("prizeImage").value=e.image,document.getElementById("prizeQuantity").value=e.quantity,document.getElementById("prizeChance").value=e.chance):(this.currentEditingPrize=null,i.textContent="Add New Prize",document.getElementById("prizeName").value="",document.getElementById("prizeImage").value="",document.getElementById("prizeQuantity").value="",document.getElementById("prizeChance").value="");let s=document.getElementById("chanceMessage");s||(s=document.createElement("div"),s.id="chanceMessage",s.style.margin="10px 0",s.style.fontWeight="bold",s.style.color="#e74c3c",t.appendChild(s)),this.updateChanceMessage(),document.getElementById("prizeChance").addEventListener("input",()=>{this.updateChanceMessage()});const o=storageManager.getPrizes(),a=o.reduce((l,d)=>d.chance>l.chance?d:l,o[0]||{chance:0});let r=document.getElementById("defaultPrizeLabel");r||(r=document.createElement("div"),r.id="defaultPrizeLabel",r.style.margin="10px 0",r.style.fontWeight="bold",r.style.color="#FFD700",r.style.fontSize="1.1em",t.appendChild(r)),r.textContent=a?`Default Prize: ${a.name} (${a.chance}%)`:"",t.classList.remove("hidden")}updateChanceMessage(){const e=document.getElementById("prizeChance"),t=parseFloat(e.value)||0,i=storageManager.getPrizes();let n=0;this.currentEditingPrize?n=i.reduce((o,a)=>o+(a.id===this.currentEditingPrize.id?t:a.chance),0):n=i.reduce((o,a)=>o+a.chance,0)+t;const s=document.getElementById("chanceMessage");n<100?(s.textContent=`Total win chance: ${n}%. ${100-n}% left to allocate.`,s.style.color="#e67e22"):n>100?(s.textContent=`Total win chance: ${n}%. Exceeded by ${n-100}%.`,s.style.color="#e74c3c"):(s.textContent="Total win chance: 100%. Ready to save!",s.style.color="#27ae60")}hidePrizeEditor(){document.getElementById("prizeEditor").classList.add("hidden"),this.currentEditingPrize=null}savePrize(){const e=document.getElementById("prizeName").value.trim(),t=document.getElementById("prizeImage").value.trim(),i=parseInt(document.getElementById("prizeQuantity").value),n=parseFloat(document.getElementById("prizeChance").value);let s=document.getElementById("chanceMessage");if(!e||!t||i<0||n<0||n>100){s.textContent="Please fill all fields with valid values.",s.style.color="#e74c3c";return}const o=storageManager.getPrizes();let a=0;if(this.currentEditingPrize?a=o.reduce((l,d)=>l+(d.id===this.currentEditingPrize.id?n:d.chance),0):a=o.reduce((l,d)=>l+d.chance,0)+n,a>100){s.textContent=`Cannot save: Exceeded by ${a-100}%. Total must be exactly 100%.`,s.style.color="#e74c3c";return}a<100?(s.textContent=`Saved. ${100-a}% left to allocate. You must reach 100% before finishing.`,s.style.color="#e67e22"):(s.textContent="Saved! Total win chance is 100%. Ready to go.",s.style.color="#27ae60");const r={name:e,image:t,quantity:i,chance:n};this.currentEditingPrize?(r.id=this.currentEditingPrize.id,storageManager.updatePrize(r)):storageManager.addPrize(r),a===100&&this.hidePrizeEditor(),this.refreshPrizesList(),window.slotMachine&&window.slotMachine.updatePrizeDisplay()}editPrize(e){const i=storageManager.getPrizes().find(n=>n.id===e);i&&this.showPrizeEditor(i)}deletePrize(e){confirm("Are you sure you want to delete this prize?")&&(storageManager.deletePrize(e),this.refreshPrizesList(),window.slotMachine&&window.slotMachine.updatePrizeDisplay())}refreshSettings(){const e=storageManager.getGameMode();document.querySelector(`input[value="${e}"]`).checked=!0}updateGameModeDisplay(){window.slotMachine&&window.slotMachine.updateGameInfo()}resetGame(){storageManager.resetAll(),this.refreshContent(),window.slotMachine&&window.slotMachine.initialize(),alert("Game has been reset successfully!")}refreshLogs(){const e=document.getElementById("spinLogs"),t=storageManager.getLogs();if(e.innerHTML="",t.length===0){e.innerHTML="<p>No spins recorded yet.</p>";return}t.forEach(i=>{const n=document.createElement("div");n.className="log-entry";const s=new Date(i.timestamp).toLocaleString();n.innerHTML=`
                <strong>${s}</strong><br>
                Prize: ${i.prizeName}<br>
                Mode: ${i.gameMode}
                ${i.gameMode==="duration"?`<br>Remaining in deck: ${i.remainingInDeck}`:""}
            `,e.appendChild(n)})}}function v(){const m=prompt("Enter admin password:");m==="admin123"?adminPanel.show():m!==null&&alert("Invalid password")}window.showAdminLogin=v;window.adminPanel=new I;class w{constructor(){this.initialize(),this.setupEventListeners()}initialize(){this.updatePrizeDisplay(),this.updateGameInfo(),this.populateReels(),this.initializeAnimations()}setupEventListeners(){document.getElementById("spinButton").addEventListener("click",()=>{this.spin()}),document.getElementById("closePopup").addEventListener("click",()=>{animationManager.closePrizePopup()}),document.getElementById("toggleWinningBox").addEventListener("click",()=>{this.toggleWinningBox()}),document.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.spin())})}updatePrizeDisplay(){const e=document.getElementById("prizeList"),t=storageManager.getPrizes();e.innerHTML="",t.forEach(i=>{const n=document.createElement("div");n.className="prize-item",n.innerHTML=`
                <img src="${i.image}" alt="${i.name}" onerror="this.src='https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png'">
                <span>${i.name}</span>
            `,e.appendChild(n)}),setTimeout(()=>{animationManager.animatePrizeShowcase()},100)}updateGameInfo(){const e=storageManager.getGameMode(),t=document.getElementById("modeDisplay"),i=document.getElementById("remainingSpins");if(t.textContent=`Mode: ${e.charAt(0).toUpperCase()+e.slice(1)}`,e==="duration"){const n=storageManager.getDeck();i.textContent=`Prizes remaining: ${n.length}`,i.style.display="block"}else i.style.display="none"}populateReels(){const e=storageManager.getPrizes();animationManager.populateReels(e)}initializeAnimations(){animationManager.initializeButtonEffects()}spin(){if(animationManager.isSpinning)return;const e=storageManager.getPrizes();if(e.length===0){alert("No prizes available! Please add some prizes in the admin panel.");return}const t=this.determineWinningPrize(e);if(!t){alert("No more prizes available!");return}let i=[],n=t;const s=e.reduce((o,a)=>a.chance>o.chance?a:o,e[0]||{chance:0});if(t.id===s.id){const o=e.filter(a=>a.id!==s.id);if(o.length===0)i=[s,s,s];else{const a=Math.floor(Math.random()*o.length);let r=Math.floor(Math.random()*o.length),l=Math.floor(Math.random()*o.length);if(Math.random()<.5)r=a;else for(;r===a&&o.length>1;)r=Math.floor(Math.random()*o.length);for(;(l===a||l===r)&&o.length>1;)l=Math.floor(Math.random()*o.length);i=[o[a],o[r],o[l]]}i[0].id===i[1].id&&i[1].id===i[2].id?n=i[0]:n=s}else i=[t,t,t],n=t;n={...n,isDefault:n.id===s.id},this.logSpin(n),this.updateGameInfo(),animationManager.spinReels(n,e,i)}determineWinningPrize(e){return storageManager.getGameMode()==="duration"?this.selectPrizeFromDeck(e):this.selectPrizeByProbability(e)}selectPrizeFromDeck(e){if(storageManager.getDeck().length===0&&storageManager.generateDeck().length===0)return null;const i=storageManager.drawFromDeck();return e.find(n=>n.id===i)}selectPrizeByProbability(e){const t=e.filter(o=>o.quantity>0);if(t.length===0)return null;const i=t.reduce((o,a)=>o+a.chance,0);if(i===0)return t[Math.floor(Math.random()*t.length)];console.log("Spin chances:",t.map(o=>({name:o.name,chance:o.chance,quantity:o.quantity})));let n=Math.random()*i;console.log("Random value for spin:",n,"Total chance:",i);let s=null;for(const o of t)if(n-=o.chance,n<=0&&!s){if(o.quantity>0){const a={...o,quantity:o.quantity-1};storageManager.updatePrize(a)}console.log("Selected prize:",o.name),s=o;break}return s||(console.log("Fallback prize:",t[t.length-1].name),s=t[t.length-1]),s}toggleWinningBox(){const e=document.getElementById("winningBox"),t=document.getElementById("toggleText");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.textContent="Hide Winning Box"):(e.classList.add("hidden"),t.textContent="Show Winning Box")}logSpin(e){const t=storageManager.getGameMode(),i={prizeName:e.name,gameMode:t};t==="duration"&&(i.remainingInDeck=storageManager.getDeck().length),storageManager.addLog(i)}}document.addEventListener("DOMContentLoaded",()=>{window.slotMachine=new w});
