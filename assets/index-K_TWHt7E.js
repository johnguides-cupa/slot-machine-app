(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const g=[{id:"cambridge-shield",name:"Cambridge Shield",filename:"Cambridge Shield.png",path:"/slot-machine-app/assets/images/prizes/Cambridge%20Shield.png",description:"Cambridge Shield logo"},{id:"development-evp-shield",name:"Development EVP Shield",filename:"Development-EVP-shield.png",path:"/slot-machine-app/assets/images/prizes/Development-EVP-shield.png",description:"Development EVP shield logo"},{id:"inclusion-evp-shield",name:"Inclusion EVP Shield",filename:"Inclusion-EVP-shield.png",path:"/slot-machine-app/assets/images/prizes/Inclusion-EVP-shield.png",description:"Inclusion EVP shield logo"},{id:"innovation-evp-shield",name:"Innovation EVP Shield",filename:"Innovation-EVP-shield.png",path:"/slot-machine-app/assets/images/prizes/Innovation-EVP-shield.png",description:"Innovation EVP shield logo"},{id:"pursuing-potential-logo",name:"Pursuing Potential Logo",filename:"Pursuing Potential Logo.png",path:"/slot-machine-app/assets/images/prizes/Pursuing%20Potential%20Logo.png",description:"Pursuing Potential brand logo"}],v=h=>`/slot-machine-app/assets/images/prizes/${encodeURIComponent(h)}`;class P{constructor(){this.initializeDefaults()}initializeDefaults(){if(!this.getPrizes().length){const e=[{id:1,name:"Grand Prize",image:g[0].path,quantity:50,chance:1},{id:2,name:"2nd Prize",image:g[1].path,quantity:10,chance:2},{id:3,name:"3rd Prize",image:g[2].path,quantity:5,chance:3},{id:4,name:"Consolation",image:g[4].path,quantity:5,chance:94}];this.setPrizes(e)}}getPrizes(){const e=localStorage.getItem("prizes");return e?JSON.parse(e):[]}setPrizes(e){localStorage.setItem("prizes",JSON.stringify(e))}addPrize(e){const t=this.getPrizes();return e.id=Date.now(),t.push(e),this.setPrizes(t),e}updatePrize(e){const t=this.getPrizes(),n=t.findIndex(i=>i.id===e.id);return n!==-1?(t[n]=e,this.setPrizes(t),!0):!1}deletePrize(e){const t=this.getPrizes(),n=t.filter(i=>i.id!==e);return this.setPrizes(n),n.length!==t.length}getLogs(){const e=localStorage.getItem("spinLogs");return e?JSON.parse(e):[]}addLog(e){const t=this.getLogs();e.timestamp=new Date().toISOString(),t.unshift(e),t.length>100&&t.splice(100),localStorage.setItem("spinLogs",JSON.stringify(t))}clearLogs(){localStorage.removeItem("spinLogs")}resetAll(){localStorage.removeItem("prizes"),localStorage.removeItem("spinLogs"),this.initializeDefaults()}}window.storageManager=new P;class S{constructor(){this.sounds={},this.audioContext=null,this.isMuted=!1,this.volume=.5,this.initializeSounds(),this.createVolumeControl()}initializeSounds(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn("Web Audio API not supported:",e)}this.createProgrammaticSounds()}createProgrammaticSounds(){this.sounds={spin:()=>this.createSpinSound(),win:()=>this.createMelody([523,659,784,1047],.3),lose:()=>this.createTone(150,.8,"sine"),click:()=>this.createTone(800,.1,"square"),reelStop:()=>this.createTone(400,.2,"triangle"),jackpot:()=>this.createCelebrationSound(),background:()=>this.createAmbientSound()}}createSpinSound(){if(!this.audioContext||this.isMuted)return;const e=2.5,t=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();t.connect(i),i.connect(n),n.connect(this.audioContext.destination),t.frequency.setValueAtTime(400,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(200,this.audioContext.currentTime+e),t.type="sawtooth",i.type="lowpass",i.frequency.setValueAtTime(1e3,this.audioContext.currentTime),i.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+e),n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(this.volume*.4,this.audioContext.currentTime+.1),n.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+e),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+e);for(let o=0;o<8;o++)setTimeout(()=>{this.createTone(600+Math.random()*200,.05,"square")},o*300)}createTone(e,t,n="sine"){if(!this.audioContext||this.isMuted)return;const i=this.audioContext.createOscillator(),o=this.audioContext.createGain();i.connect(o),o.connect(this.audioContext.destination),i.frequency.setValueAtTime(e,this.audioContext.currentTime),i.type=n,o.gain.setValueAtTime(0,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(this.volume*.3,this.audioContext.currentTime+.01),o.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+t),i.start(this.audioContext.currentTime),i.stop(this.audioContext.currentTime+t)}createMelody(e,t){!this.audioContext||this.isMuted||e.forEach((n,i)=>{setTimeout(()=>{this.createTone(n,t,"sine")},i*t*200)})}createCelebrationSound(){if(!this.audioContext||this.isMuted)return;[261,329,392,523,659,784,1047,1319].forEach((t,n)=>{setTimeout(()=>{this.createTone(t,.4,"sine")},n*100)}),setTimeout(()=>{for(let t=0;t<10;t++)setTimeout(()=>{this.createTone(1e3+Math.random()*1e3,.1,"square")},t*50)},800)}createAmbientSound(){if(!this.audioContext||this.isMuted)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(60,this.audioContext.currentTime),e.type="sine",t.gain.setValueAtTime(this.volume*.1,this.audioContext.currentTime),e.start(),setTimeout(()=>{t.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+1),e.stop(this.audioContext.currentTime+1)},5e3)}playSound(e){if(this.sounds[e]&&!this.isMuted)try{this.audioContext&&this.audioContext.state==="suspended"?this.audioContext.resume().then(()=>{this.sounds[e]()}).catch(t=>{console.warn("Failed to resume audio context:",t)}):this.sounds[e]()}catch(t){console.warn("Error playing sound:",t)}else this.isMuted?console.log(`Sound ${e} muted`):console.warn(`Sound ${e} not found`)}mute(){this.isMuted=!0,this.updateVolumeButton()}unmute(){this.isMuted=!1,this.updateVolumeButton()}toggleMute(){this.isMuted=!this.isMuted,this.updateVolumeButton()}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.updateVolumeSlider()}createVolumeControl(){const e=document.querySelector(".control-panel");if(!e)return;const t=document.createElement("div");t.className="sound-control",t.innerHTML=`
            <div class="sound-controls">
                <button id="muteButton" class="mute-button" title="Toggle Sound">
                    🔊
                </button>
                <input type="range" id="volumeSlider" class="volume-slider" 
                       min="0" max="100" value="50" title="Volume">
                <span class="volume-label">50%</span>
                <button id="testSoundButton" class="test-sound-button" title="Test Sound">
                    🎵
                </button>
            </div>
        `;const n=document.createElement("style");n.textContent=`
            .sound-control {
                margin-top: 15px;
                display: flex;
                justify-content: center;
            }
            
            .sound-controls {
                display: flex;
                align-items: center;
                gap: 10px;
                background: rgba(0,0,0,0.3);
                padding: 10px;
                border-radius: 8px;
                border: 2px solid #FFD700;
            }
            
            .mute-button {
                background: none;
                border: none;
                font-size: 1.5em;
                cursor: pointer;
                padding: 5px;
                border-radius: 4px;
                transition: all 0.2s ease;
            }
            
            .mute-button:hover {
                background: rgba(255,255,255,0.2);
            }
            
            .mute-button.muted {
                opacity: 0.5;
            }
            
            .test-sound-button {
                background: none;
                border: none;
                font-size: 1.2em;
                cursor: pointer;
                padding: 5px;
                border-radius: 4px;
                transition: all 0.2s ease;
            }
            
            .test-sound-button:hover {
                background: rgba(255,255,255,0.2);
            }
            
            .volume-slider {
                width: 100px;
                height: 5px;
                border-radius: 5px;
                background: #ddd;
                outline: none;
                -webkit-appearance: none;
            }
            
            .volume-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background: #FFD700;
                cursor: pointer;
            }
            
            .volume-slider::-moz-range-thumb {
                width: 15px;
                height: 15px;
                border-radius: 50%;
                background: #FFD700;
                cursor: pointer;
                border: none;
            }
            
            .volume-label {
                color: white;
                font-weight: bold;
                min-width: 30px;
                text-align: center;
                font-size: 0.9em;
            }
        `,document.head.appendChild(n),e.appendChild(t),document.getElementById("muteButton").addEventListener("click",()=>{this.toggleMute(),this.playSound("click")}),document.getElementById("volumeSlider").addEventListener("input",i=>{const o=parseInt(i.target.value)/100;this.setVolume(o),this.playSound("click")}),document.getElementById("testSoundButton").addEventListener("click",()=>{console.log("Testing spin sound..."),this.testSound("spin")})}updateVolumeButton(){const e=document.getElementById("muteButton");e&&(e.textContent=this.isMuted?"🔇":"🔊",e.classList.toggle("muted",this.isMuted))}updateVolumeSlider(){const e=document.getElementById("volumeSlider"),t=document.querySelector(".volume-label");e&&(e.value=this.volume*100),t&&(t.textContent=Math.round(this.volume*100)+"%")}onSpinStart(){this.playSound("spin")}onReelStop(){this.playSound("reelStop")}onWin(e=!1){e?this.playSound("jackpot"):this.playSound("win")}onLose(){this.playSound("lose")}onButtonClick(){this.playSound("click")}onBackgroundStart(){this.playSound("background")}testSound(e){console.log(`Testing sound: ${e}`),this.audioContext&&this.audioContext.state==="suspended"?(console.log("Audio context suspended, trying to resume..."),this.audioContext.resume().then(()=>{console.log("Audio context resumed"),this.playSound(e)})):this.playSound(e)}testAllSounds(){["click","spin","reelStop","win","lose","jackpot"].forEach((t,n)=>{setTimeout(()=>{console.log(`Testing ${t}...`),this.testSound(t)},n*1e3)})}}window.soundManager=new S;class C{constructor(){this.isSpinning=!1,this.reelHeight=null,this.idleTimelines=[]}createReelItems(e,t=null){const n=[];for(let i=0;i<15;i++)e.forEach(o=>{n.push(this.createReelItem(o))});return n}createReelItem(e){const t=document.createElement("div");return t.className="reel-item",t.innerHTML=`
            <img src="${e.image}" alt="${e.name}" onerror="this.src='https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png'">
        `,this.reelHeight||(document.body.appendChild(t),this.reelHeight=t.offsetHeight,document.body.removeChild(t)),t}populateReels(e){document.querySelectorAll(".reel").forEach((n,i)=>{const o=n.querySelector(".reel-strip");o.innerHTML="",this.createReelItems(e).forEach(a=>o.appendChild(a)),gsap.set(o,{y:-this.reelHeight})}),this.startIdleAnimation()}startIdleAnimation(){this.stopIdleAnimation();const e=Array.from(document.querySelectorAll(".reel .reel-strip"));this.idleTimelines=[];const t=[6,7.5,9];e.forEach((n,i)=>{const o=gsap.timeline({repeat:-1}),a=gsap.getProperty(n,"y")-this.reelHeight*10;o.to(n,{y:a,duration:t[i%t.length],ease:"linear"}),this.idleTimelines.push(o)})}stopIdleAnimation(){this.idleTimelines&&this.idleTimelines.length&&this.idleTimelines.forEach(e=>e.kill()),this.idleTimelines=[]}async spinReels(e,t,n){if(this.isSpinning)return;this.isSpinning=!0,this.stopIdleAnimation(),window.soundManager&&window.soundManager.onSpinStart();const i=Array.from(document.querySelectorAll(".reel .reel-strip")),o=document.getElementById("spinButton");if(o.disabled=!0,o.querySelector(".button-text").textContent="SPINNING...",!this.reelHeight){const c=this.createReelItem(t[0]);document.body.appendChild(c),this.reelHeight=c.offsetHeight,document.body.removeChild(c)}const s=30,a=10;i.forEach((c,y)=>{c.innerHTML="";for(let p=0;p<s;p++){const w=t[Math.floor(Math.random()*t.length)];c.appendChild(this.createReelItem(w))}c.appendChild(this.createReelItem(n[y]));for(let p=0;p<a;p++){const w=t[Math.floor(Math.random()*t.length)];c.appendChild(this.createReelItem(w))}const z=Math.floor(c.parentNode.offsetHeight/this.reelHeight),f=this.reelHeight*Math.floor(z/2)-30;gsap.set(c,{y:-(s*this.reelHeight-f)})});const r=i.map((c,y)=>{const z=s,f=Math.floor(c.parentNode.offsetHeight/this.reelHeight),p=this.reelHeight*Math.floor(f/2)-30;return-(z*this.reelHeight-p)}),d=.15,l=15,u=1.5,m=this.reelHeight*10,E=i.map((c,y)=>new Promise(z=>{const f=gsap.timeline({repeat:-1});f.to(c,{y:`-=${m}`,duration:d,ease:"none"}),setTimeout(()=>{f.kill(),gsap.to(c,{y:r[y],duration:1.2,ease:"power3.out",onComplete:()=>{window.soundManager&&window.soundManager.onReelStop(),z()}})},y*u*1e3+l*d*1e3)}));for(let c=0;c<E.length;c++)await E[c];setTimeout(()=>{this.showPrizePopup(e)},500),o.disabled=!1,o.querySelector(".button-text").textContent="SPIN!",this.isSpinning=!1,document.getElementById("closePopup").addEventListener("click",()=>{setTimeout(()=>{this.populateReels(t)},400)},{once:!0})}calculateTargetPositions(e,t){const n=[],i=t.length;for(let o=0;o<3;o++){let s=t.findIndex(u=>u.id===e.id);s===-1&&(s=0);const r=(7+Math.floor(Math.random()*2))*i+s,d=this.reelHeight,l=-(r*this.reelHeight-d);n.push(l)}return n}animateReel(e,t,n){return new Promise(i=>{const o=gsap.timeline();o.to(e,{y:t-this.reelHeight*10,duration:n*.7,ease:"power2.in"}),o.to(e,{y:t,duration:n*.3,ease:"power3.out",onComplete:()=>{i()}})})}showPrizePopup(e){const t=document.getElementById("prizePopup"),n=document.getElementById("wonPrizeImage"),i=document.getElementById("wonPrizeName"),o=document.getElementById("prizePopupTitle"),s=t.querySelector(".prize-shield");if(n.src=e.image,i.textContent=e.name,e.isDefault)o&&(o.textContent="Better luck next time!"),s&&(s.textContent="😢"),window.soundManager&&window.soundManager.onLose();else if(o&&(o.textContent="Congratulations!"),s&&(s.textContent="🏆"),window.soundManager){const a=e.chance<=15;window.soundManager.onWin(a)}t.classList.remove("hidden"),gsap.fromTo(t.querySelector(".popup-content"),{scale:0,rotation:-10},{scale:1,rotation:0,duration:.5,ease:"back.out(1.7)"}),e.isDefault||this.triggerConfetti()}triggerConfetti(){const t=Date.now()+3e3,n={startVelocity:30,spread:360,ticks:60,zIndex:999};function i(s,a){return Math.random()*(a-s)+s}const o=setInterval(function(){const s=t-Date.now();if(s<=0)return clearInterval(o);const a=50*(s/3e3);confetti(Object.assign({},n,{particleCount:a,origin:{x:i(.1,.3),y:Math.random()-.2}})),confetti(Object.assign({},n,{particleCount:a,origin:{x:i(.7,.9),y:Math.random()-.2}}))},250)}closePrizePopup(){const e=document.getElementById("prizePopup");gsap.to(e.querySelector(".popup-content"),{scale:0,rotation:10,duration:.3,ease:"back.in(1.7)",onComplete:()=>{e.classList.add("hidden")}})}animatePrizeShowcase(){const e=document.querySelectorAll(".prize-item");gsap.fromTo(e,{y:-50,opacity:0},{y:0,opacity:1,duration:.6,stagger:.1,ease:"back.out(1.7)"})}initializeButtonEffects(){const e=document.getElementById("spinButton");e.addEventListener("mouseenter",()=>{e.disabled||gsap.to(e,{scale:1.05,duration:.2})}),e.addEventListener("mouseleave",()=>{e.disabled||gsap.to(e,{scale:1,duration:.2})})}}window.animationManager=new C;class b{constructor(){this.currentEditingPrize=null,this.initializeEventListeners()}initializeEventListeners(){document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>this.switchTab(e.dataset.tab))}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("prizeName");e&&(e.removeAttribute("pattern"),e.style.userSelect="text",e.style.pointerEvents="auto",e.addEventListener("keydown",t=>{t.keyCode===32&&t.stopPropagation()}))}),document.getElementById("closeAdmin").addEventListener("click",()=>{if(storageManager.getPrizes().reduce((n,i)=>n+i.chance,0)!==100){alert("Total win chance must be exactly 100% before closing the admin panel.");return}this.hide()}),document.getElementById("addPrize").addEventListener("click",()=>{window.soundManager&&window.soundManager.onButtonClick(),this.showPrizeEditor()}),document.getElementById("savePrize").addEventListener("click",()=>{window.soundManager&&window.soundManager.onButtonClick(),this.savePrize()}),document.getElementById("cancelEdit").addEventListener("click",()=>{window.soundManager&&window.soundManager.onButtonClick(),this.hidePrizeEditor()}),document.getElementById("resetGame").addEventListener("click",()=>{window.soundManager&&window.soundManager.onButtonClick(),confirm("Are you sure you want to reset the game and clear all logs?")&&this.resetGame()})}show(){document.getElementById("adminPanel").classList.remove("hidden"),this.refreshContent(),setTimeout(()=>{const e=document.getElementById("prizeName");e&&(e.removeAttribute("pattern"),e.style.userSelect="text",e.style.pointerEvents="auto",e.addEventListener("keydown",t=>{t.keyCode===32&&t.stopPropagation()}),console.log("Prize name input initialized for spaces"))},100)}hide(){document.getElementById("adminPanel").classList.add("hidden"),this.hidePrizeEditor(),this.refreshSlotMachine()}switchTab(e){switch(document.querySelectorAll(".tab-button").forEach(t=>{t.classList.remove("active")}),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".tab-content").forEach(t=>{t.classList.remove("active")}),document.getElementById(`${e}Tab`).classList.add("active"),e){case"prizes":this.refreshPrizesList();break;case"settings":this.refreshSettings();break;case"logs":this.refreshLogs();break}}refreshContent(){this.refreshPrizesList(),this.refreshSettings(),this.refreshLogs()}refreshPrizesList(){const e=document.getElementById("prizesList"),t=storageManager.getPrizes();e.innerHTML="",t.forEach(n=>{const i=document.createElement("div");i.className="prize-card",i.innerHTML=`
                <img src="${n.image}" alt="${n.name}" onerror="this.src='https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png'">
                <div class="prize-info">
                    <h4>${n.name}</h4>
                    <p>Quantity: ${n.quantity}</p>
                    <p>Win Chance: ${n.chance}%</p>
                </div>
                <div class="prize-actions">
                    <button onclick="adminPanel.editPrize(${n.id})">Edit</button>
                    <button class="delete" onclick="adminPanel.deletePrize(${n.id})">Delete</button>
                </div>
            `,e.appendChild(i)})}showPrizeEditor(e=null){const t=document.getElementById("prizeEditor"),n=document.getElementById("editorTitle");function i(d,l){const u=document.getElementById(d);if(u){let m=document.getElementById(d+"-label");m||(m=document.createElement("label"),m.id=d+"-label",m.htmlFor=d,m.textContent=l,m.style.display="block",m.style.fontWeight="bold",m.style.margin="8px 0 2px 0",u.parentNode.insertBefore(m,u))}}i("prizeName","Prize Name"),i("prizeImage","Prize Image URL"),i("prizeQuantity","Quantity"),i("prizeChance","Win Chance (%)"),this.createImageSourceSelector(),e?(this.currentEditingPrize=e,n.textContent="Edit Prize",document.getElementById("prizeName").value=e.name,document.getElementById("prizeImage").value=e.image||"",document.getElementById("prizeQuantity").value=e.quantity,document.getElementById("prizeChance").value=e.chance,this.updateImageSourceSelector(e.image)):(this.currentEditingPrize=null,n.textContent="Add New Prize",document.getElementById("prizeName").value="",document.getElementById("prizeImage").value="",document.getElementById("prizeQuantity").value="",document.getElementById("prizeChance").value="",this.updateImageSourceSelector(""));let o=document.getElementById("chanceMessage");o||(o=document.createElement("div"),o.id="chanceMessage",o.style.margin="10px 0",o.style.fontWeight="bold",o.style.color="#e74c3c",t.appendChild(o)),this.updateChanceMessage(),document.getElementById("prizeChance").addEventListener("input",()=>{this.updateChanceMessage()});const s=storageManager.getPrizes(),a=s.reduce((d,l)=>l.chance>d.chance?l:d,s[0]||{chance:0});let r=document.getElementById("defaultPrizeLabel");r||(r=document.createElement("div"),r.id="defaultPrizeLabel",r.style.margin="10px 0",r.style.fontWeight="bold",r.style.color="#FFD700",r.style.fontSize="1.1em",t.appendChild(r)),r.textContent=a?`Default Prize: ${a.name} (${a.chance}%)`:"",t.classList.remove("hidden")}updateChanceMessage(){const e=document.getElementById("prizeChance"),t=parseFloat(e.value)||0,n=storageManager.getPrizes();let i=0;this.currentEditingPrize?i=n.reduce((s,a)=>s+(a.id===this.currentEditingPrize.id?t:a.chance),0):i=n.reduce((s,a)=>s+a.chance,0)+t;const o=document.getElementById("chanceMessage");i<100?(o.textContent=`Total win chance: ${i}%. ${100-i}% left to allocate.`,o.style.color="#e67e22"):i>100?(o.textContent=`Total win chance: ${i}%. Exceeded by ${i-100}%.`,o.style.color="#e74c3c"):(o.textContent="Total win chance: 100%. Ready to save!",o.style.color="#27ae60")}hidePrizeEditor(){document.getElementById("prizeEditor").classList.add("hidden"),this.currentEditingPrize=null}createImageSourceSelector(){if(document.getElementById("imageSourceSelector"))return;const e=document.getElementById("prizeImage"),t=e.parentNode,n=document.createElement("div");n.id="imageSourceSelector",n.className="image-source-selector";const i=document.createElement("label");i.textContent="Image Source",i.style.display="block",i.style.fontWeight="bold",i.style.margin="8px 0 5px 0";const o=document.createElement("div");o.className="image-source-option",o.innerHTML=`
            <label>
                <input type="radio" name="imageSource" value="url" checked>
                <span>Use URL</span>
            </label>
        `;const s=document.createElement("div");s.className="image-source-option",s.innerHTML=`
            <label>
                <input type="radio" name="imageSource" value="asset">
                <span>Choose from Assets</span>
            </label>
        `;const a=document.createElement("div");a.id="assetGallery",a.className="asset-gallery hidden",g.forEach(l=>{const u=document.createElement("div");u.className="asset-item",u.dataset.assetId=l.id,u.dataset.assetPath=l.path;const m=v(l.filename);u.innerHTML=`
                <img src="${m}" alt="${l.name}" title="${l.description}">
                <span>${l.name}</span>
            `,u.addEventListener("click",()=>{this.selectAsset(l)}),a.appendChild(u)});const r=document.createElement("div");r.id="imagePreview",r.className="image-preview",r.innerHTML=`
            <label>Preview:</label>
            <div class="preview-content">
                <img id="previewImage" src="" alt="No image selected" style="display: none;">
                <span id="previewText">No image selected</span>
            </div>
        `,[o,s].forEach(l=>{const u=l.querySelector('input[type="radio"]');u.addEventListener("change",()=>{this.handleImageSourceChange(u.value)})}),e.addEventListener("input",()=>{this.updateImagePreview(e.value)}),t.insertBefore(i,e),t.insertBefore(n,e),n.appendChild(o),n.appendChild(s),n.appendChild(a),t.insertBefore(r,e.nextSibling)}updateImageSourceSelector(e){const t=document.querySelector('input[name="imageSource"][value="url"]'),n=document.querySelector('input[name="imageSource"][value="asset"]');if(g.some(o=>{const s=v(o.filename);return e===s||e===o.path||e.includes(o.filename)})){n.checked=!0,this.handleImageSourceChange("asset");const o=g.find(s=>{const a=v(s.filename);return e===a||e===s.path||e.includes(s.filename)});o&&this.highlightSelectedAsset(o.id)}else t.checked=!0,this.handleImageSourceChange("url");this.updateImagePreview(e)}handleImageSourceChange(e){const t=document.getElementById("prizeImage"),n=document.getElementById("assetGallery");e==="asset"?(t.style.display="none",n.classList.remove("hidden")):(t.style.display="block",n.classList.add("hidden"),this.clearAssetSelection())}selectAsset(e){const t=document.getElementById("prizeImage"),n=v(e.filename);t.value=n,this.highlightSelectedAsset(e.id),this.updateImagePreview(n)}highlightSelectedAsset(e){document.querySelectorAll(".asset-item").forEach(n=>{n.classList.remove("selected")});const t=document.querySelector(`[data-asset-id="${e}"]`);t&&t.classList.add("selected")}clearAssetSelection(){document.querySelectorAll(".asset-item").forEach(e=>{e.classList.remove("selected")})}updateImagePreview(e){const t=document.getElementById("previewImage"),n=document.getElementById("previewText");e&&e.trim()?(t.src=e,t.style.display="block",n.style.display="none",t.onerror=()=>{t.style.display="none",n.style.display="block",n.textContent="Failed to load image"}):(t.style.display="none",n.style.display="block",n.textContent="No image selected")}savePrize(){const e=document.getElementById("prizeName").value.trim(),t=document.getElementById("prizeImage").value.trim(),n=parseInt(document.getElementById("prizeQuantity").value),i=parseFloat(document.getElementById("prizeChance").value);let o=document.getElementById("chanceMessage");if(!e||!t||n<0||i<0||i>100){o.textContent="Please fill all fields with valid values.",o.style.color="#e74c3c";return}const s=storageManager.getPrizes();let a=0;if(this.currentEditingPrize?a=s.reduce((d,l)=>d+(l.id===this.currentEditingPrize.id?i:l.chance),0):a=s.reduce((d,l)=>d+l.chance,0)+i,a>100){o.textContent=`Cannot save: Exceeded by ${a-100}%. Total must be exactly 100%.`,o.style.color="#e74c3c";return}a<100?(o.textContent=`Saved. ${100-a}% left to allocate. You must reach 100% before finishing.`,o.style.color="#e67e22"):(o.textContent="Saved! Total win chance is 100%. Ready to go.",o.style.color="#27ae60");const r={name:e,image:t,quantity:n,chance:i};this.currentEditingPrize?(r.id=this.currentEditingPrize.id,storageManager.updatePrize(r)):storageManager.addPrize(r),a===100&&this.hidePrizeEditor(),this.refreshPrizesList(),window.slotMachine&&(window.slotMachine.updatePrizeDisplay(),window.slotMachine.populateReels())}editPrize(e){const n=storageManager.getPrizes().find(i=>i.id===e);n&&this.showPrizeEditor(n)}deletePrize(e){confirm("Are you sure you want to delete this prize?")&&(storageManager.deletePrize(e),this.refreshPrizesList(),window.slotMachine&&(window.slotMachine.updatePrizeDisplay(),window.slotMachine.populateReels()))}refreshSettings(){}resetGame(){storageManager.resetAll(),this.refreshContent(),window.slotMachine&&window.slotMachine.initialize(),alert("Game has been reset successfully!")}refreshLogs(){const e=document.getElementById("spinLogs"),t=storageManager.getLogs();if(e.innerHTML="",t.length===0){e.innerHTML="<p>No spins recorded yet.</p>";return}t.forEach(n=>{const i=document.createElement("div");i.className="log-entry";const o=new Date(n.timestamp).toLocaleString();i.innerHTML=`
                <strong>${o}</strong><br>
                Prize: ${n.prizeName}<br>
                Mode: ${n.gameMode}
                ${n.gameMode==="duration"?`<br>Remaining in deck: ${n.remainingInDeck}`:""}
            `,e.appendChild(i)})}refreshSlotMachine(){window.slotMachine&&window.slotMachine.populateReels()}}function M(){const h=prompt("Enter admin password:");h==="admin123"?adminPanel.show():h!==null&&alert("Invalid password")}window.showAdminLogin=M;window.adminPanel=new b;class I{constructor(){this.initialize(),this.setupEventListeners()}initialize(){this.updatePrizeDisplay(),this.populateReels(),this.initializeAnimations(),setTimeout(()=>{window.soundManager&&window.soundManager.onBackgroundStart()},2e3)}setupEventListeners(){document.getElementById("spinButton").addEventListener("click",()=>{window.soundManager&&window.soundManager.onButtonClick(),this.spin()}),document.getElementById("closePopup").addEventListener("click",()=>{window.soundManager&&window.soundManager.onButtonClick(),animationManager.closePrizePopup()}),document.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.spin())})}updatePrizeDisplay(){const e=document.getElementById("prizeList"),t=storageManager.getPrizes();e.innerHTML="",t.forEach(n=>{const i=document.createElement("div");i.className="prize-item",i.innerHTML=`
                <img src="${n.image}" alt="${n.name}" onerror="this.src='https://static.vecteezy.com/system/resources/previews/019/040/585/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-chocolate-free-png.png'">
                <span>${n.name}</span>
            `,e.appendChild(i)}),setTimeout(()=>{animationManager.animatePrizeShowcase()},100)}populateReels(){const e=storageManager.getPrizes();animationManager.populateReels(e)}initializeAnimations(){animationManager.initializeButtonEffects()}spin(){if(animationManager.isSpinning)return;const e=storageManager.getPrizes();if(e.length===0){alert("No prizes available! Please add some prizes in the admin panel.");return}const t=this.determineWinningPrize(e);if(!t){alert("No more prizes available!");return}let n=[],i=t;const o=e.reduce((s,a)=>a.chance>s.chance?a:s,e[0]||{chance:0});if(t.id===o.id){const s=e.filter(a=>a.id!==o.id);if(s.length===0)n=[o,o,o];else{const a=Math.floor(Math.random()*s.length);let r=Math.floor(Math.random()*s.length),d=Math.floor(Math.random()*s.length);if(Math.random()<.5)r=a;else for(;r===a&&s.length>1;)r=Math.floor(Math.random()*s.length);for(;(d===a||d===r)&&s.length>1;)d=Math.floor(Math.random()*s.length);n=[s[a],s[r],s[d]]}n[0].id===n[1].id&&n[1].id===n[2].id?i=n[0]:i=o}else n=[t,t,t],i=t;i={...i,isDefault:i.id===o.id},this.logSpin(i),animationManager.spinReels(i,e,n)}determineWinningPrize(e){return this.selectPrizeByProbability(e)}selectPrizeByProbability(e){const t=e.filter(s=>s.quantity>0);if(t.length===0)return null;const n=t.reduce((s,a)=>s+a.chance,0);if(n===0)return t[Math.floor(Math.random()*t.length)];console.log("Spin chances:",t.map(s=>({name:s.name,chance:s.chance,quantity:s.quantity})));let i=Math.random()*n;console.log("Random value for spin:",i,"Total chance:",n);let o=null;for(const s of t)if(i-=s.chance,i<=0&&!o){if(s.quantity>0){const a={...s,quantity:s.quantity-1};storageManager.updatePrize(a)}console.log("Selected prize:",s.name),o=s;break}return o||(console.log("Fallback prize:",t[t.length-1].name),o=t[t.length-1]),o}logSpin(e){const t={prizeName:e.name,gameMode:"Probability"};storageManager.addLog(t)}}document.addEventListener("DOMContentLoaded",()=>{window.slotMachine=new I});
